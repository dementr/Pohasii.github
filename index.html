<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body style="height: 100%">

<script src="wasm_exec.js"></script>

<canvas id="canvas" width="1280" height="720" style="border: 1px solid cadetblue;"></canvas>

<script>

    const go = new Go();
    // WebAssembly.instantiate(fetch("lib.wasm"), go.importObject).then((result) => {
    //     go.run(result.instance);
    // });
    // WebAssembly.instantiateStreaming(fetch("lib.wasm"), go.importObject).then((result) => {
    //     go.run(result.instance);
    // });

    fetch('lib.wasm').then(response =>
        response.arrayBuffer()
    ).then(bytes =>
        WebAssembly.instantiate(bytes, go.importObject)
    ).then(result =>
        go.run(result.instance)
    )


    let JumpStatus = false

    let RestartStatus = true

    // dean code 01 04 2021
    // function ChangeJumpStatus () {
    //     JumpStatus = JumpStatus !== true;
    // }

    // it is API for wasm
    function isStatus () {
        return JumpStatus
    }

    // it is API for wasm
    function Restart () {
        const co = RestartStatus
        RestartStatus = false
        return co
    }


        document.addEventListener('keydown', function(event){
            if (event.defaultPrevented) {
                return; // Do nothing if the event was already processed
            }

            switch (event.code) {
                case "Space": // IE/Edge specific value
                    JumpStatus = true
                    break;
                case "KeyR":
                    // Do something for "down arrow" key press.
                    RestartStatus = true
                    break;
                case "KeyP": // IE/Edge specific value
                    if (Time === 1000) {
                        Time = 0
                    } else Time = 1000
                    break;
            }
        })

    document.addEventListener('keyup', function(event){
        if (event.defaultPrevented) {
            return; // Do nothing if the event was already processed
        }

        switch (event.code) {
            case "Space": // IE/Edge specific value
                JumpStatus = false
                break;
        }
    })

        document.addEventListener('touchstart', function(event){
            if (event.touches.length === 1) {
                JumpStatus = true
                //do smth
            }
        }, false)

    document.addEventListener('touchend', function(event){
        if (event.touches.length === 1) {
            JumpStatus = false
            //do smth
        }
    }, false)

    function geRays () {
        try {
            let str = String.fromCharCode.apply(String, GetRays());
            return JSON.parse(str);
            // return obj
            //console.log(obj)
        } catch (e) {
            console.log(e)
        }
        return []
    }

    function geScore () {
        try {
            let str = String.fromCharCode.apply(String, GetScore());
            return JSON.parse(str);
            //return obj
            //console.log(obj)
        } catch (e) {
            console.log(e)
        }
        return []
    }

    function geStatus () {
        try {
            let str = String.fromCharCode.apply(String, GetStatus());
            return JSON.parse(str);
            //return obj
            //console.log(obj)
        } catch (e) {
            console.log(e)
        }
        return null
    }

    // function print () {
    //     // console.log(` rays: ${geRays()}`)
    //     // console.log(` score: ${geScore()}`)
    //     //console.log(` status: ${geStatus()}`)
    // }
    // while (true) {
    //     console.log(getRays ())
    //     sleep(1000)
    // }
    // setInterval(print, 1000)
    ///setTimeout(console.log(GetRays()), pause)

</script>
</body>
</html>